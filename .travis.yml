sudo: required
services:
- docker
before_script:
- docker pull navikt/helm
- git clone https://github.com/nais/charts nais/charts
script:
#- /bin/bash bump.sh $GH_TOKEN
#- git tag -a $(/bin/cat ./version) -m "auto-tag from Makefile [skip ci]" && git push --tags https://$GH_TOKEN@github.com/nais/naisd
#- docker run --entrypoint=/bin/bash -w /helm -v $(pwd)/helm/naisd:/helm navikt/helm -c "/bin/helm registry login quay.io -u nais+travis -p $QUAY_TOKEN && /bin/helm registry push --namespace nais --channel stable quay.io"
- docker run -v $(pwd)/nais/charts:/charts -v $(pwd)/:/rook-cluster -w /charts navikt/helm package /rook-cluster
- docker run -v $(pwd)/nais/charts:/charts -w /charts navikt/helm repo index --url https://nais.github.io/charts .
- echo "<html><body><pre>$(cat index.yaml)</pre></body></html>" > index.html
- git add --all
- git commit -m "auto-update by travis [skip ci]"
#- git push https://$GH_TOKEN@github.com/nais/charts
branches:
  only:
  - master
